# 要件定義書 (SRS) — Executive Console  
**zk‑CertFramework / 責任者システム** 最終更新: 2025-07-10 (Version 2.2)

---

## 1. 目的
Executive Console は教授・研究責任者向けの **Tauri デスクトップアプリケーション** として、①**年度別ZKP回路の独立デプロイ**と ②**Ledger Nano X による厳格な認証管理** を行う。**Trust Minimized アーキテクチャ** により、外部依存を排除し、**年度完全独立システム** (2025年度、2026年度等) の暗号パラメータ管理を提供する。

## 2. スコープ
| 区分 | 含む | 含まない |
|------|------|----------|
| **年度管理** | 年度別回路セット独立デプロイ・VK管理 | 年度間の共有状態・複雑な鍵ローテーション |
| **認証システム** | Ledger Nano X EIP-191 署名必須 | WebAuthn・ソフトウェア鍵・HSM |
| **アプリ形態** | Tauri デスクトップアプリ (単一実行ファイル) | Web アプリ・モバイルアプリ・サーバークライアント |
| **ブロックチェーン** | Polygon zkEVM デプロイ・読み取り | 複数チェーン・クロスチェーン・レイヤー2 |
| **ファイル管理** | ローカル JSON・回路ファイル管理 | データベース・外部ストレージ・クラウド |

## 3. 用語
| 用語 | 定義 |
|------|------|
| **年度別セット** | Document{Year}.circom + VK{Year} + DocumentNFT{Year} の独立単位 |
| **Ledger EIP-191** | Ledger Nano X での Ethereum Personal Message 署名 |
| **Trust Minimized** | 外部依存を最小化し、検証可能なコンポーネントのみ使用 |
| **Yearly Independence** | 年度間の完全独立、共有秘密・依存関係なし |

## 4. 利害関係者・アクター
| ステークホルダ | 主要関心事 | システム期待 |
|----------------|------------|--------------|
| **教授** | 回路の学術的正当性・年度別管理 | 回路アップロード・承認・デプロイの学術ワークフロー |
| **研究助手** | 技術的デプロイ作業・運用 | 確実なデプロイ手順・エラー回復・ログ管理 |
| **大学IT管理者** | システム全体の運用・セキュリティ | 監査ログ・セキュリティ準拠・災害復旧 |
| **学生 (間接)** | 安定した証明生成サービス | 常に利用可能な検証鍵・回路ファイル |

## 5. ユースケース詳細
### 5.1 UC‑EC‑01: 年度別セット新規作成
- **主アクター**: 教授
- **前提条件**: Ledger Nano X 接続 + 回路ファイル準備完了
- **基本フロー**:
  1. 「新規年度セット作成」メニュー選択
  2. 年度 (例: 2027) + NFT メタデータ入力
  3. Certificate2027.circom ファイルアップロード
  4. Circom コンパイル + SnarkJS setup 実行
  5. VK ハッシュ・回路ハッシュ計算・確認
  6. Ledger Nano X で EIP-191 署名実行
  7. YearlyDeploymentManager.createYearlySet() 呼び出し
  8. トランザクション確認 + ローカル設定更新
- **成功条件**: 2027年度セットがブロックチェーンデプロイ完了
- **例外フロー**: 
  - E1. Ledger未接続 → 接続手順ガイド表示
  - E2. 回路コンパイル失敗 → エラー詳細・修正案内
  - E3. トランザクション失敗 → ガス不足・ネットワーク状態確認

### 5.2 UC‑EC‑02: 既存年度セット管理・監視
- **主アクター**: 研究助手
- **前提条件**: 既存デプロイ済み年度セット存在
- **基本フロー**:
  1. ダッシュボードで年度一覧・ステータス確認
  2. 特定年度の詳細情報（NFTコントラクト・VKハッシュ等）表示
  3. ブロックチェーン同期状態・ガス価格監視
  4. エクスポート機能で年度データバックアップ
- **成功条件**: 正確な年度別状態情報の取得・表示

### 5.3 UC‑EC‑03: Trust Minimized 監査・エクスポート
- **主アクター**: 大学IT管理者
- **前提条件**: 操作履歴・署名ログ蓄積済み
- **基本フロー**:
  1. 操作ログ・Ledger署名履歴の確認
  2. 年度別設定・回路ファイルの整合性検証
  3. 監査レポート生成・エクスポート
  4. USBドライブへのバックアップ作成
- **成功条件**: 完全な監査証跡の取得・検証

## 6. 機能要求
| ID | 要求 | 検証基準 |
|----|------|----------|
| **FR‑EC‑01** | Tauri デスクトップアプリとして単一実行ファイル配布 | Windows/macOS/Linux で実行可能 |
| **FR‑EC‑02** | 全管理操作で Ledger Nano X EIP-191 署名必須 | ソフトウェア鍵による操作は一切不可 |
| **FR‑EC‑03** | 年度別回路ファイル (Document{Year}.circom) アップロード・コンパイル | Circom 2.1.4 + SnarkJS 0.7 統合 |
| **FR‑EC‑04** | 年度別セット (回路+VK+NFT) 独立デプロイ | 年度間の依存関係・共有状態なし |
| **FR‑EC‑05** | ローカル JSON ファイルによる設定・状態管理 | ~/.zk-cert-framework/ 以下の構造化ファイル |
| **FR‑EC‑06** | Polygon zkEVM YearlyDeploymentManager コントラクト操作 | スマートコントラクト呼び出し・イベント監視 |
| **FR‑EC‑07** | 操作ログ・Ledger署名履歴の永続化・監査 | 改竄検知・完全な監査証跡 |

## 7. 非機能要求
| NFR ID | カテゴリ | 指標 | 目標 | 測定方法 |
|--------|----------|------|------|----------|
| **NFR‑EC‑P1** | パフォーマンス | 回路コンパイル時間 | ≤ 30秒 | Document{Year}.circom (65k制約) |
| **NFR‑EC‑P2** | パフォーマンス | アプリ起動時間 | ≤ 3秒 | Tauri アプリ起動完了まで |
| **NFR‑EC‑S1** | セキュリティ | Ledger ハードウェア認証 | 100% | 全操作でハードウェア署名必須 |
| **NFR‑EC‑S2** | セキュリティ | EIP-191 フィッシング対策 | 完全 | ドメイン・構造化メッセージ検証 |
| **NFR‑EC‑R1** | 信頼性 | 年度独立性 | 100% | 年度セット間の依存関係ゼロ |
| **NFR‑EC‑R2** | 信頼性 | ローカルファイル整合性 | 100% | SHA-3 ハッシュによる検証 |
| **NFR‑EC‑U1** | ユーザビリティ | Ledger操作ガイド | 完全 | 初回ユーザーの成功操作率 ≥ 95% |
| **NFR‑EC‑M1** | 保守性 | 単一実行ファイル配布 | 100% | インストーラー不要・依存関係なし |

## 8. セキュリティ要求 (Trust Minimized)
### 8.1 ハードウェアセキュリティ
- **SEC‑01**: **Ledger Nano X 必須**: 全ての重要操作でハードウェア署名
- **SEC‑02**: **EIP-191 Personal Sign**: 構造化された人間可読メッセージ
- **SEC‑03**: **フィッシング対策**: ドメイン検証・タイムスタンプ・nonce
- **SEC‑04**: **物理確認**: Ledger 画面での操作内容確認必須

### 8.2 Trust Minimization Security
- **SEC‑05**: **外部依存最小化**: Polygon zkEVM 以外の外部サービス禁止
- **SEC‑06**: **ローカル暗号化**: 重要ファイルの AES-256 暗号化
- **SEC‑07**: **署名検証**: ダウンロードファイル・ライブラリの署名検証
- **SEC‑08**: **監査証跡**: 全操作の暗号学的検証可能なログ

### 8.3 年度独立セキュリティ
- **SEC‑09**: **年度分離**: 年度別秘密の完全分離・漏洩防止
- **SEC‑10**: **ロールバック防止**: 過去年度への不正変更検知
- **SEC‑11**: **整合性保証**: VK・回路ファイルのハッシュチェーン

## 9. 年度別独立アーキテクチャ要求
### 9.1 独立性原則
- **ARCH‑01**: **完全分離**: 各年度は独立した回路・VK・NFTコントラクト
- **ARCH‑02**: **共有状態なし**: 年度間の共有データ・依存関係の禁止
- **ARCH‑03**: **並行運用**: 複数年度の同時運用・管理可能
- **ARCH‑04**: **独立スケール**: 年度別の学生数制限・制約の独立設定

### 9.2 デプロイ戦略
- **ARCH‑05**: **独立コントラクト**: 年度毎の DocumentNFT{Year} デプロイ
- **ARCH‑06**: **独立VK**: 年度毎の検証鍵・証明鍵セット
- **ARCH‑07**: **独立回路**: Document{Year}.circom の完全分離

## 10. Tauri アプリケーション要求
### 10.1 デスクトップ統合
- **DESK‑01**: **ネイティブUI**: OS標準のファイルダイアログ・通知
- **DESK‑02**: **自動更新**: 署名検証付きアップデート機能
- **DESK‑03**: **システム統合**: システムトレイ・右クリックメニュー
- **DESK‑04**: **マルチOS**: Windows・macOS・Linux 対応

### 10.2 セキュア Tauri
- **DESK‑05**: **Node統合無効**: nodeIntegration: false
- **DESK‑06**: **コンテキスト分離**: contextIsolation: true  
- **DESK‑07**: **CSP適用**: Content Security Policy Strict
- **DESK‑08**: **サンドボックス**: 適切なサンドボックス設定

## 11. 受入基準
### 11.1 機能受入基準
- [ ] 全機能要求 (FR‑EC‑01 ~ FR‑EC‑07) の完全実装
- [ ] 3つの主要ユースケース (UC‑EC‑01~03) の正常動作
- [ ] Ledger Nano X を用いた End-to-End テスト成功
- [ ] 年度別独立デプロイ・運用の確認

### 11.2 性能受入基準
- [ ] 回路コンパイル時間 ≤ 30秒 (Document{Year}.circom)
- [ ] アプリ起動時間 ≤ 5秒 (冷起動)
- [ ] Ledger署名レスポンス ≤ 10秒
- [ ] ファイル操作レスポンス ≤ 1秒

### 11.3 セキュリティ受入基準
- [ ] Ledger以外での重要操作は一切不可
- [ ] EIP-191フィッシング攻撃シナリオ耐性確認
- [ ] ローカルファイル改竄検知機能確認
- [ ] 静的セキュリティ解析 (Semgrep, ESLint Security) クリア

## 12. 制約・依存関係
### 12.1 ハードウェア制約
- **Ledger Nano X**: ファームウェア 2.0.0+ 必須
- **USB接続**: 安定したUSB通信環境
- **ストレージ**: 1GB以上の空き容量 (回路ファイル・ログ)

### 12.2 ソフトウェア制約  
- **Tauri**: 2.0+ (セキュリティ対応版)
- **Node.js**: 18+ LTS (Circom/SnarkJS互換性)
- **OS**: Windows 10+, macOS 12+, Ubuntu 20.04+

### 12.3 ネットワーク制約
- **Polygon zkEVM**: メインネット・Cardonaテストネット対応
- **RPC接続**: 信頼できるPolygon RPC エンドポイント
- **帯域幅**: 年度セットデプロイ時の安定接続

## 13. リスク・対策
| リスク ID | リスク内容 | 影響度 | 対策 |
|-----------|------------|--------|------|
| **R‑EC‑01** | Ledger Nano X 供給停止・廃止 | 高 | 代替ハードウェア (YubiKey HSM) 対応準備 |
| **R‑EC‑02** | Polygon zkEVM ネットワーク障害 | 中 | 複数 RPC エンドポイント + フォールバック |
| **R‑EC‑03** | Circom/SnarkJS API 変更 | 中 | バージョン固定 + アップデート戦略 |
| **R‑EC‑04** | 年度セット設定破損 | 中 | 自動バックアップ + 復元機能 |
| **R‑EC‑05** | Tauri セキュリティ脆弱性 | 高 | 定期セキュリティアップデート + 自動更新 |

## 14. 監査・コンプライアンス
### 14.1 監査要求
- **全操作ログ**: 改竄検知付きローカルログ 7年保存
- **Ledger署名履歴**: EIP-191メッセージ・署名の完全記録  
- **設定変更履歴**: 年度セット・回路ファイルの変更追跡
- **アクセス制御**: 操作者・時刻・操作内容の記録

### 14.2 コンプライアンス
- **IEEE 830**: SRS標準準拠
- **ISO 27001**: 情報セキュリティ管理
- **暗号標準**: NIST準拠暗号アルゴリズム使用
- **データ保護**: GDPR準拠（適用範囲内）

---
