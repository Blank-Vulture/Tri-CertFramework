# ソフトウェア要件定義書 (SRS) — ZK-CertFramework プロトタイプ版
**版 1.1  最終更新: 2025‑07‑10**

---

## 1. 目的
本書では、**教授による実動確認を目的とした簡素化プロトタイプ**として、**Trust Minimized・2025年度限定**な書類真正性証明システムを定義する。PROTOTYPE.mdに基づき、**VK配布をPolygon zkEVM上に直接保存**、**回路ファイルをGitHub Releases経由で配布**、**経費節約のためAmoyテストネット利用**により実装する。学生が**ブラウザのみ**でCircom回路とSnarkJSによりZKP証明を生成、**検証者はPDFファイルとブロックチェーン直接取得VK**のみで真正性を確認できる。

## 2. スコープ
### 含まれる
* **証明者システム (Scholar Prover PWA)**: 基本的なPasskey署名 + ZKP生成 + PDF/A‑3埋め込み + **ブロックチェーン直接VK取得**
* **責任者システム (Executive Console Tauri)**: 2025年度限定の回路デプロイ + **VKスマートコントラクト直接保存** + Ledger必須認証
* **管理者システム (Registrar Console Tauri)**: **手動用意の**学生データ管理 + Merkle tree構築 + **事前配置Ptauファイル利用**
* **検証者システム (Verifier UI SSG)**: 基本的なPDF検証 + **ブロックチェーン直接VK取得**
* **配布方法**: **GitHub Pages** (Verifier UI) + **GitHub Releases** (Tauriアプリ・回路ファイル)
* **デモ機能**: 教授が確認できる主要ユースケースの動作

### 含まれない
* 複数年度対応・年度切り替え機能
* URL経由でのVK配布機能
* IPFS配布機能
* 詳細なエラーハンドリング・監査ログ
* 高度なパフォーマンス最適化
* 完全オフライン検証機能（Service Worker複雑実装回避）
* 多言語対応・アクセシビリティ
* 包括的なユニット・E2Eテスト
* メインネット対応（経費節約のためAmoyテストネットのみ）

## 3. 用語定義
| 用語 | 定義 |
|------|------|
| **プロトタイプ** | 教授向けデモンストレーション用の簡素化実装 |
| **2025年度限定** | 複数年度対応を除外し、2025年度のみに特化 |
| **Amoyテストネット** | 経費節約目的でのPolygon zkEVMテストネット環境利用 |
| **GitHub Releases配布** | IPFSに代わる回路ファイル配布方法 |
| **ブロックチェーン直接VK** | URL・APIアクセスに代わるVK取得方法 |
| **VK直接保存** | YearlyDeploymentManagerスマートコントラクトストレージへのVK JSONデータ保存 |
| **事前配置Ptau** | 複雑な管理を回避するための事前生成・配置済みPtauファイル |

## 4. 利害関係者と関心事
* **教授** – プロトタイプの動作確認；研究コンセプトの検証；30分以内での操作習得
* **学生（デモ用）** – 基本的な証明生成体験；複雑な設定なし；ブロックチェーン直接VK取得の体験
* **管理者（デモ用）** – 簡単なデータ管理操作；最小限のセットアップ；手動用意データでの作業
* **検証者（デモ用）** – 基本的なPDF検証機能；明確な成功/失敗表示；ブロックチェーン連携の実感

## 5. プロトタイプシステム・アーキテクチャ（PROTOTYPE.md準拠）

### 5.1 証明者システム（学生デモインターフェース）
- **タイプ**: Progressive Web App (PWA) - 簡素版
- **目的**: 基本的なZKP生成とPDF埋め込み + **ブロックチェーン直接VK取得**
- **制限**: Service Worker最小実装、詳細エラー処理除外、完全オフライン機能なし
- **年度**: 2025年度固定
- **VK取得**: **Polygon zkEVMコントラクトから直接取得**

### 5.2 責任者システム（教授デモインターフェース）
- **タイプ**: Tauriデスクトップアプリケーション - 基本版
- **目的**: 2025年度回路デプロイ + **VKスマートコントラクト直接保存**
- **制限**: 複数年度管理機能なし、**Ptauファイル事前配置**
- **認証**: Ledger Nano X必須（簡素化検証）
- **VK保存**: **YearlyDeploymentManagerスマートコントラクトストレージに直接保存**

### 5.3 管理者システム（学務デモインターフェース）
- **タイプ**: Tauriデスクトップアプリケーション - 簡素版
- **目的**: 基本的なデータ管理とPDF生成
- **制限**: CSV機能除外、複数年度対応なし、**手動用意のPasskey公開鍵データ利用**
- **データ**: JSON形式のみ

### 5.4 検証者システム（雇用主デモインターフェース）
- **タイプ**: 静的サイト（Next.js 15 SSG）
- **目的**: 基本的な証明書検証 + **ブロックチェーン直接VK取得**
- **制限**: 詳細レポート機能なし、エラー詳細最小限
- **配布**: **GitHub Pages**
- **VK取得**: **スマートコントラクトから直接取得・VKハッシュ検証**

## 6. プロトタイプ用ユースケース概要（PROTOTYPE.md対応）
1. **UC‑PT‑01 2025年度回路デプロイ + VK直接保存**（責任者システム）
2. **UC‑PT‑02 手動用意学生データ管理 & Merkle Tree構築**（管理者システム）
3. **UC‑PT‑03 基本ZKP生成 & PDF埋め込み & ブロックチェーンVK取得**（証明者システム）
4. **UC‑PT‑04 PDF検証 & ブロックチェーン直接VK検証**（検証者システム）
5. **UC‑PT‑05 教授による動作確認**（全システム統合）

## 7. 機能要求 - プロトタイプ版（PROTOTYPE.md準拠）
| ID | 要求 | 実装 | 簡素化内容 |
|----|------|------|-----------|
| FR‑PT‑01 | 2025年度固定のZKP証明生成 | 証明者システム | 年度選択機能なし |
| FR‑PT‑02 | Document2025.circom回路のみ対応 | 全システム | 複数回路管理なし |
| FR‑PT‑03 | **ブロックチェーンから直接VK取得** | 証明者・検証者システム | **URL配布機能なし** |
| FR‑PT‑04 | **VKをスマートコントラクトに直接保存** | 責任者システム | **特定URL配布なし** |
| FR‑PT‑05 | **VKハッシュ値とコントラクト保存値の照合** | 証明者・検証者システム | **整合性検証** |
| FR‑PT‑06 | Ledger Nano X EIP-191署名（基本） | 責任者システム | 詳細検証なし |
| FR‑PT‑07 | **GitHub ReleasesからのPtau・回路ファイル配布** | 責任者システム | **IPFS配布なし** |
| FR‑PT‑08 | **事前配置Ptauファイル参照** | 責任者システム | **複雑な管理なし** |
| FR‑PT‑09 | JSONデータ形式のみサポート | 管理者システム | CSV機能除外 |
| FR‑PT‑10 | **手動用意のPasskey公開鍵データ利用** | 管理者システム | **複雑な収集なし** |
| FR‑PT‑11 | **Amoyテストネット限定動作** | 全システム | **マルチネットワーク対応なし・経費節約** |
| FR‑PT‑12 | **GitHub Pages/Releases配布** | 検証者・責任者・管理者システム | **専用配布サーバーなし** |

## 8. 非機能要求 - プロトタイプ版（PROTOTYPE.md優先度調整準拠）
| 分類 | 指標 | 目標 | 備考 |
|----|------|------|------|
| 性能 | 証明生成時間 | ≤ 30秒 | **厳密な最適化なし（5秒→30秒）** |
| 性能 | PDF検証時間 | ≤ 5秒 | 基本レベル |
| 性能 | VK取得時間 | ≤ 3秒 | **ブロックチェーンRPC経由** |
| セキュリティ | Ledger認証 | 必須 | 基本検証のみ |
| セキュリティ | VKハッシュ検証 | 必須 | **コントラクト保存値との照合** |
| ユーザビリティ | 操作成功率 | ≥ 80% | デモ環境想定 |
| ユーザビリティ | 教授操作習得時間 | ≤ 30分 | **主要デモシナリオ重視** |
| 信頼性 | デモ動作安定性 | 90% | 教授確認レベル |
| 保守性 | セットアップ時間 | ≤ 30分 | 簡素化により短縮 |
| 経済性 | ネットワーク費用 | **Amoyテストネット限定** | **経費節約目的** |

## 9. プロトタイプ用セキュリティ要求（PROTOTYPE.md Trust Minimization準拠）

### 9.1 Trust Minimization原則（簡素版）
| 原則 | プロトタイプ実装 |
|------|------------------|
| **サーバーなし** | 全システムローカル実行（基本レベル） |
| **データベースなし** | JSONファイルのみ |
| **外部サービス最小限** | **Amoyテストネット + GitHub Releases・経費節約** |
| **ハードウェアセキュリティ** | Ledger Nano X必須（基本検証） |
| **年度独立性** | 2025年度のみで検証 |
| **VK配布Trust Minimized** | **ブロックチェーン直接保存・URL依存なし** |

### 9.2 プロトタイプ用EIP-191セキュリティ実装
```
ドメイン: "zk-cert-framework-prototype.local"
メッセージ構造（簡素版）:
- 操作タイプ: "deploy_yearly_set_2025_with_vk_storage"
- タイムスタンプ（10分間有効）
- 2025年度固定パラメータ
- VKハッシュ・VKデータ保存確認
- 基本的な警告メッセージ
```

### 9.3 VK保存・取得セキュリティ（新規要件）
| 要求 | 実装 |
|------|------|
| **VK直接保存** | YearlyDeploymentManagerコントラクトストレージ |
| **VKハッシュ検証** | 取得VKとコントラクト保存ハッシュの照合 |
| **データ整合性** | SHA-3-512によるVKハッシュ計算・検証 |
| **改ざん検出** | ハッシュ不一致時のエラー表示 |

## 10. データ要求 - プロトタイプ版（PROTOTYPE.md準拠）

### 10.1 学生データ（students-2025.json）- 手動用意版
```json
{
  "version": "1.0-prototype",
  "year": 2025,
  "dataSource": "manual_preparation",
  "students": [
    {
      "id": "2025001",
      "name": "田中太郎",
      "email": "tanaka@university.edu",
      "passkey": {
        "publicKey": "pQECAyYgASFYI...",
        "credentialId": "AQIDBAUGBwgJ...",
        "algorithm": -7
      },
      "commit": "0x1a2b3c4d...",
      "manuallyPrepared": true
    }
  ],
  "maxStudents": 100,
  "demoMode": true,
  "ptauPrelocated": true
}
```

### 10.2 年度セット設定（yearly-set-2025.json）- VK直接保存版
```json
{
  "version": "1.0-prototype",
  "year": 2025,
  "nftContract": "0x...",
  "vkHash": "0x...",
  "vkStoredInContract": true,
  "vkStorageMethod": "smart_contract_direct",
  "circuitHash": "0x...",
  "circuitSource": "github_releases",
  "merkleRoot": "0x...",
  "deployedAt": "2025-01-20T10:00:00Z",
  "network": "amoy",
  "networkReason": "cost_saving",
  "ptauPrelocated": true,
  "demoMode": true
}
```

### 10.3 VKデータ構造（スマートコントラクト保存）
```json
{
  "contractStorage": {
    "vkData": "stringified_vk_json",
    "vkHash": "sha3_512_hash",
    "year": 2025,
    "storedAt": "block_timestamp"
  },
  "retrievalMethod": "smart_contract_call",
  "verificationMethod": "hash_comparison"
}
```

## 11. 受入基準 - プロトタイプ版（PROTOTYPE.md重視）
- **2025年度回路デプロイ + VK直接保存**が1回成功
- **ブロックチェーンからのVK取得・ハッシュ検証**が成功
- **手動用意学生データ（10-50名）**でMerkle Tree構築成功
- **GitHub Releasesからの回路ファイル取得**が成功
- **事前配置Ptauファイル利用**でのコンパイル成功
- 証明生成→PDF埋め込み→**ブロックチェーンVK取得**→検証の一連のフロー成功
- Ledger Nano X認証が基本レベルで動作
- **Amoyテストネット**での全動作確認
- **教授による主要機能の動作確認完了（30分以内）**
- 基本的なエラー状況での適切な表示

## 12. プロトタイプ制約（PROTOTYPE.md準拠）
- **対象ユーザー数**: 最大100名学生
- **対応年度**: 2025年度のみ（YearlySet概念維持・単一年度運用）
- **ネットワーク**: Polygon zkEVM Amoyテストネットのみ（経費節約）
- **VK配布**: ブロックチェーン直接保存のみ
- **回路配布**: GitHub Releasesのみ
- **Ptauファイル**: 事前配置のみ
- **学生データ**: 手動用意JSONのみ
- **言語**: 日本語のみ
- **ブラウザ**: Chrome/Edge最新版のみテスト
- **デバイス**: macOS/Windows基本サポート

## 13. リスク管理 - プロトタイプ版（PROTOTYPE.md考慮）
| ID | リスク | 対策 |
|----|------|------|
| R‑PT‑1 | Amoyテストネット不安定 | 基本的なリトライ機能・メインネット移行準備 |
| R‑PT‑2 | 回路コンパイル失敗 | 事前テスト済み回路使用・GitHub Releases配布 |
| R‑PT‑3 | Ledger接続問題 | 基本的なガイド表示 |
| R‑PT‑4 | **GitHub Releases配布失敗** | **手動配布フォールバック** |
| R‑PT‑5 | **ブロックチェーンVK取得失敗** | **基本的なリトライ・フォールバック** |
| R‑PT‑6 | **VKハッシュ不一致** | **エラー表示・再取得フロー** |

## 14. 成功基準 - プロトタイプ版（PROTOTYPE.md目標準拠）
### 14.1 技術的成功基準
- [ ] 4システムの基本機能が動作
- [ ] **VKブロックチェーン直接保存・取得・ハッシュ検証**の成功
- [ ] **GitHub Releases経由での回路ファイル配布・取得**の成功
- [ ] **事前配置Ptauファイル利用**でのコンパイル成功
- [ ] 2025年度データでの証明生成・検証成功
- [ ] Ledger認証フローの完了
- [ ] PDF/A-3埋め込み・抽出の成功
- [ ] **Amoyテストネット**での安定動作

### 14.2 デモンストレーション成功基準（PROTOTYPE.md重視）
- [ ] **教授による30分以内での操作習得**
- [ ] **主要ユースケースの一発成功**
- [ ] エラー状況での適切なフィードバック
- [ ] システム間連携の視覚的確認
- [ ] **ブロックチェーン連携の実感・理解**

### 14.3 概念検証成功基準（PROTOTYPE.md Trust Minimization）
- [ ] **Trust Minimized設計の有効性確認**
- [ ] **ブロックチェーン直接VK配布**の実用性確認
- [ ] **GitHub Releases配布**の実用性確認
- [ ] ZKP証明書真正性の実証
- [ ] ユーザビリティの基本的検証
- [ ] **経費節約（Amoyテストネット）**の有効性確認

---

**プロトタイプスコープ（PROTOTYPE.md準拠）**: VK配布のブロックチェーン直接保存、GitHub Releases経由配布、経費節約のためのAmoyテストネット利用により、複雑な機能を除外し、コアコンセプトの動作実証に集中することで、教授が研究価値を効率的に評価できる環境を提供する。 